<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>AI maker - í–„ìŠ¤í„° ì±—ë´‡</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .bulb {
      position: absolute;
      width: 60px;
      left: 50%;
      transform: translateX(-50%);
      top: -40px;
      display: none;
    }

    .bulb.blinking {
      animation: bulb-blink 0.6s ease-in-out 3;
    }

    .hamster-container {
      position: relative;
      display: inline-block;
    }

    @keyframes bulb-blink {
      0%   { opacity: 0.2; transform: scale(1); }
      50%  { opacity: 1;   transform: scale(1.1); }
      100% { opacity: 0.2; transform: scale(1); }
    }

    .extra-activity {
      margin-top: 30px;
      padding: 20px;
      background-color: rgba(255,255,255,0.8);
      border-radius: 15px;
      max-width: 90%;
      margin-left: auto;
      margin-right: auto;
      box-sizing: border-box;
    }

    .extra-title {
      font-size: 22px;
      margin-bottom: 15px;
      font-weight: bold;
      color: #333;
    }

    .chatgpt-banner {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #000;
      color: #fff;
      padding: 15px 20px;
      border-radius: 10px;
      text-decoration: none;
      gap: 12px;
      margin-bottom: 20px;
      transition: background-color 0.3s;
    }

    .chatgpt-banner:hover {
      background-color: #222;
    }

    .chatgpt-logo {
      height: 28px;
      width: auto;
    }

    .extra-description {
      font-size: 15px;
      color: #333;
      line-height: 1.6;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="{{ url_for('static', filename='logo.gif') }}" alt="ë¡œê³ " class="logo">
    <h1>AI maker</h1>
    <p class="subtitle">ë‚´ê°€ ì§ì ‘ ë§Œë“  ì±—ë´‡ì„ ì‚¬ìš©í•´ë³´ì!<br>í–„ìŠ¤í„°ê°€ ì •ë‹µì„ ë§ì¶”ëŠ”ì§€ ì§€ì¼œë´ìš”!</p>
  </div>

  <div class="chatbot">
    <div class="hamster-container">
      <img id="bulb" src="{{ url_for('static', filename='lightbulb.png') }}" class="bulb">
      <img id="hamster" src="{{ url_for('static', filename='default.png') }}" class="hamster-img">
    </div>
    <p id="messageBox" class="msg"> </p>

    <div class="input-box" id="inputArea" style="display:none;">
      <input type="text" id="userInput" placeholder="ë¬¸ì¥ì„ ì…ë ¥í•´ë³´ì„¸ìš”!">
      <button onclick="sendMessage()">í™•ì¸</button>
    </div>
  </div>

  <!-- âœ… ì¶”ê°€ ì§í™œë™ ì„¹ì…˜ -->
  <div class="extra-activity">
    <h2 class="extra-title">ì¶”ê°€ ì§í™œë™</h2>

    <a href="https://chat.openai.com/" target="_blank" class="chatgpt-banner">
      <img src="{{ url_for('static', filename='chatgpt_logo.png') }}" class="chatgpt-logo" alt="ChatGPT ë¡œê³ ">
      <span>í´ë¦­í•˜ë©´ Chat-Gpt ì‚¬ì´íŠ¸ì— ì—°ê²°ë¼ìš”.</span>
    </a>

    <p class="extra-description">
      Chat-Gptì—ì„œ ì±—ë´‡ì„ ì‹¤í—˜í•´ë´ìš”.<br>
      <strong>ìƒê°í•´ë³´ê¸°:</strong> ë‚´ê°€ ë§Œë“  ì±—ë´‡ê³¼ ë‹µì´ ì°¨ì´ê°€ ë‚˜ëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?<br>
      Chat-Gptê°€ ì´ëŸ° ë‹µë³€ì„ í•˜ê¸°ê¹Œì§€ ì–´ë–¤ ê³¼ì •ì´ ìˆì—ˆì„ê¹Œìš”?
    </p>
  </div>

  <script>
    const hamster = document.getElementById("hamster");
    const msgBox = document.getElementById("messageBox");
    const inputArea = document.getElementById("inputArea");
    const bulb = document.getElementById("bulb");

    const messages = [
      "ì•ˆë…•!",
      "ë‚´ê°€ ì§€ê¸ˆë¶€í„° ë„ˆì˜ ë§ˆìŒì„ ì½ì–´ë³¼ê²Œ!",
      "ë„¤ê°€ ì•„ê¹Œ ì•Œë ¤ì¤€ ë¬¸ì¥ë“¤ë¡œ ë‚´ê°€ ë°©ê¸ˆ ê³µë¶€ë¥¼ í–ˆì–´!",
      "ë¬¸ì¥ì„ ì“°ë©´,\në„¤ê°€ í–„ë²„ê±°ê°€ ë¨¹ê³ ì‹¶ì€ì§€,\në¨¹ê³ ì‹¶ì§€ ì•Šì€ì§€ ë§ì¶°ë³¼ê²Œ~"
    ];

    function blink(times = 2, callback) {
      let count = 0;
      const interval = setInterval(() => {
        hamster.src = "{{ url_for('static', filename='closed.png') }}";
        setTimeout(() => {
          hamster.src = "{{ url_for('static', filename='default.png') }}";
        }, 200);
        count++;
        if (count >= times) {
          clearInterval(interval);
          if (callback) callback();
        }
      }, 600);
    }

    function typeMessage(text, callback) {
      msgBox.innerText = "";
      let chars = [...text];
      let i = 0;
      const interval = setInterval(() => {
        msgBox.innerText += chars[i];
        i++;
        if (i >= chars.length) {
          clearInterval(interval);
          if (callback) callback();
        }
      }, 60);
    }

    function showMessage(index = 0) {
      if (index >= messages.length) {
        inputArea.style.display = "block";
        return;
      }
      blink(1, () => {
        typeMessage(messages[index], () => {
          setTimeout(() => showMessage(index + 1), 1000);
        });
      });
    }

    function sendMessage() {
      const message = document.getElementById("userInput").value;
      msgBox.innerText = "ìƒê° ì¤‘...";
      hamster.src = "{{ url_for('static', filename='closed.png') }}";
      bulb.style.display = "none";

      fetch("/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: message })
      })
      .then(response => response.json())
      .then(data => {
        setTimeout(() => {
          if (data.confidence < 0.6) {
            hamster.src = "{{ url_for('static', filename='question.png') }}";
            typeMessage("ì˜ ì´í•´ê°€ ì•ˆë¼...\në‹¤ë¥¸ ë¬¸ì¥ì„ ë‹¤ì‹œ ì¨ì¤„ë˜?");
          } else {
            bulb.style.display = "block";
            bulb.classList.add("blinking");
            setTimeout(() => {
              bulb.style.display = "none";
              bulb.classList.remove("blinking");
            }, 1800);

            if (data.result === 1) {
              hamster.src = "{{ url_for('static', filename='smile.png') }}";
              typeMessage("ì•Œì•˜ë‹¤!\në„ˆ ì§€ê¸ˆ í–„ë²„ê±°ê°€ ë¨¹ê³ ì‹¶êµ¬ë‚˜!");
            } else {
              hamster.src = "{{ url_for('static', filename='sad.png') }}";
              typeMessage("ì•Œì•˜ë‹¤!\në„ˆ ì§€ê¸ˆ í–„ë²„ê±°ê°€ ë¨¹ê³ ì‹¶ì§€ ì•Šêµ¬ë‚˜ ğŸ˜¢");
            }
          }
        }, 500);
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("userInput").addEventListener("keydown", function(event) {
        if (event.key === "Enter") {
          sendMessage();
        }
      });
      showMessage();
    });
  </script>
</body>
</html>
